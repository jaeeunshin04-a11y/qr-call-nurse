<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê°„í˜¸ì‚¬ ëª¨ë‹ˆí„°ë§</title>
<style>
body { font-family:'ë‚˜ëˆ”ê³ ë”•',sans-serif; background:#f0f4ff; text-align:center; padding:30px; }
h2 { color:#2b4eff; margin-bottom:20px; }
table{margin:0 auto;border-collapse:collapse;width:90%;max-width:1000px;background:white;border-radius:15px;overflow:hidden;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
th,td{border-bottom:1px solid #eee;padding:12px;font-size:16px;}
th{background:#eaf0ff;color:#333;}
.red{background:#ffcccc;}
.yellow{background:#fff4cc;}
.green{background:#ccffcc;}
button{padding:6px 10px;border:none;border-radius:10px;background:#2b4eff;color:white;cursor:pointer;transition:0.2s;}
button:hover{background:#1f36cc;}
</style>
</head>
<body>
<h2>ğŸ©º ê°„í˜¸ì‚¬ í˜¸ì¶œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h2>
<p>ìƒˆ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
<table id="requestTable">
<thead>
<tr><th>ë“±ë¡ë²ˆí˜¸</th><th>í™˜ìëª…</th><th>ë³‘ì‹¤</th><th>ìš”ì²­í•­ëª©</th><th>í•˜ìœ„í•­ëª©</th><th>ìš”ì²­ì‹œê°„</th><th>í™•ì¸</th><th>ì™„ë£Œ</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
const sheetURL="https://script.google.com/macros/s/AKfycbzQVKCXorHUox-68EiaSwSqqmDvIfgU_FNCfCq37nfxmCkl76Op97upp7rNw4SrZ9do/exec";

function getColor(type){
  if(type.includes("í†µì¦")||type.includes("ì•½")||type.includes("í™”ì¥ì‹¤")) return "red";
  if(type.includes("ìˆ˜ì•¡")||type.includes("ì¹¨êµ¬")) return "yellow";
  return "";
}

function summarizeEtc(type,etc){
  if(type==="ìˆ˜ì•¡") {
    if(etc.includes("ì•ŒëŒ")) return "ìˆ˜ì•¡ ê¸°ê³„ ì•ŒëŒ";
    if(etc.includes("êº¾")) return "ìˆ˜ì•¡ ì¤„ êº¾ì„";
  }
  if(type==="ì¹¨êµ¬/ì‹œíŠ¸") return etc.includes("ì –")?"ì¹¨êµ¬ ì –ìŒ":"ì‹œíŠ¸ ì˜¤ì—¼";
  if(type==="í™”ì¥ì‹¤") return etc.includes("ë„ì›€")?"í™”ì¥ì‹¤ ì´ë™ ë„ì›€":"ê¸°ì €ê·€ êµí™˜";
  return etc;
}

async function updateStatus(row,action,btn){
  const tr=btn.closest("tr");
  if(action==="confirm"){
    btn.innerText="í™•ì¸ë¨";
    await fetch(sheetURL,{method:"POST",body:JSON.stringify({action:"confirm",row:row})});
  } else if(action==="complete"){
    btn.innerText="ì™„ë£Œë¨";
    tr.classList.add("green");
    await fetch(sheetURL,{method:"POST",body:JSON.stringify({action:"complete",row:row})});
    setTimeout(()=>tr.remove(),3000);
  }
  loadRequests(); // ìƒˆë¡œê³ ì¹¨
}

function renderTable(data){
  const tbody=document.querySelector("#requestTable tbody");
  tbody.innerHTML="";
  data.forEach(row=>{
    const tr=document.createElement("tr");
    tr.classList.add(getColor(row.requestType));
    const summarizedEtc=summarizeEtc(row.requestType,row.etc);
    tr.innerHTML=`
      <td>${row.patientId}</td>
      <td>${row.patientName}</td>
      <td>${row.room}</td>
      <td>${row.requestType}</td>
      <td>${summarizedEtc}</td>
      <td>${row.time.split("T").pop().split(".")[0]}</td>
      <td><button onclick="updateStatus(${row.row},'confirm',this)">${row.confirmTime?"í™•ì¸ë¨":"í™•ì¸"}</button></td>
      <td><button onclick="updateStatus(${row.row},'complete',this)">${row.completeTime?"ì™„ë£Œë¨":"ì™„ë£Œ"}</button></td>
    `;
    tbody.appendChild(tr);
  });
}

async function loadRequests(){
  const res=await fetch(sheetURL+"?mode=getData");
  const data=await res.json();
  renderTable(data);
}

setInterval(loadRequests,2000);
loadRequests();
</script>
</body>
</html>
